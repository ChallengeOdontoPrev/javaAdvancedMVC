<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerir Endereços - OdontoPrev</title>
    <link rel="stylesheet" href="/css/manageAddresses.css">
</head>
<body>

    <div class="container">
        <div class="logo">
            <img src="/images/logo.png" alt="OdontoPrev">
        </div>

        <h2>Gerir endereços</h2>

        <div class="endereco-container">
            <input type="text" id="search" placeholder="Buscar" class="search-input">

            <div id="endereco-list"></div>
        </div>
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Faz a requisição ao endpoint /address para carregar os endereços
            fetch('/address')
                .then(response => response.json()) // Converte a resposta para JSON
                .then(data => {
                    const enderecoList = document.getElementById('endereco-list'); // Seleciona o container

                    // Itera sobre os endereços retornados pelo backend
                    data.forEach(address => {
                        // Cria uma nova div para cada endereço
                        const enderecoItem = document.createElement('div');
                        enderecoItem.className = 'endereco-item';

                        // Cria a div de informações do endereço
                        const enderecoInfo = document.createElement('div');
                        enderecoInfo.className = 'endereco-info';
                        enderecoInfo.innerHTML = `<span>${address.street}</span>`; // Exibe apenas o nome da rua

                        // Cria a div de ações (editar/excluir)
                        const enderecoActions = document.createElement('div');
                        enderecoActions.className = 'endereco-actions';

                        const editButton = document.createElement('button');
                        editButton.className = 'edit-button';
                        editButton.innerHTML = '<img src="/images/edit-icon.png" alt="Editar">';

                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'delete-button';
                        deleteButton.innerHTML = '<img src="/images/delete-icon.png" alt="Excluir">';
                        deleteButton.dataset.id = address.id; // Armazena o ID do endereço no botão

                        // Adiciona os botões à div de ações
                        enderecoActions.appendChild(editButton);
                        enderecoActions.appendChild(deleteButton);

                        // Monta o item completo
                        enderecoItem.appendChild(enderecoInfo);
                        enderecoItem.appendChild(enderecoActions);

                        // Adiciona o item ao container
                        enderecoList.appendChild(enderecoItem);
                    });

                    // Adiciona eventos de clique aos botões de exclusão
                    const deleteButtons = document.querySelectorAll('.delete-button');
                    deleteButtons.forEach(button => {
                        button.addEventListener('click', function () {
                            const id = this.dataset.id; // Obtém o ID do endereço
                            if (confirm('Tem certeza que deseja excluir este endereço?')) {
                                // Faz a requisição DELETE para /address/{id}
                                fetch(`/address/${id}`, {
                                    method: 'DELETE'
                                })
                                .then(response => {
                                    if (response.ok) {
                                        alert('Endereço excluído com sucesso!');
                                        location.reload(); // Recarrega a página após a exclusão
                                    } else {
                                        alert('Erro ao excluir o endereço. Certifique-se de que ele não está associado a nenhuma clinica.');
                                    }
                                })
                                .catch(error => console.error('Erro:', error));
                            }
                        });
                    });
                })
                .catch(error => console.error('Erro ao carregar endereços:', error));
        });
    </script>

</body>
</html>